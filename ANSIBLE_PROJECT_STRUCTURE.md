# ๐๏ธ ะัะฐะฒะธะปัะฝะฐั ััััะบัััะฐ Ansible ะฟัะพะตะบัะฐ

Ansible-lint ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะพะฒะตััะตั ััััะบัััั ะฒะฐัะตะณะพ ะฟัะพะตะบัะฐ ะธ ะฟัะตะดัะฟัะตะถะดะฐะตั ะพ ะฝะฐัััะตะฝะธัั best practices.

---

## โ ะัะฐะฒะธะปัะฝะฐั ััััะบัััะฐ ะฟัะพะตะบัะฐ

### ะะฐะทะพะฒะฐั ััััะบัััะฐ

```
ansible-project/
โโโ ansible.cfg               # ะะพะฝัะธะณััะฐัะธั Ansible
โโโ inventory/                # ะะปะธ: hosts, inventory.ini
โ   โโโ production/
โ   โ   โโโ hosts
โ   โโโ staging/
โ       โโโ hosts
โโโ group_vars/               # โ ะ ะะะะะ ะฟัะพะตะบัะฐ
โ   โโโ all.yml
โ   โโโ webservers.yml
โ   โโโ databases.yml
โโโ host_vars/                # โ ะ ะะะะะ ะฟัะพะตะบัะฐ
โ   โโโ server1.yml
โ   โโโ server2.yml
โโโ roles/                    # โ ะะพะปะธ ะฒ ะพัะดะตะปัะฝะพะน ะฟะฐะฟะบะต
โ   โโโ common/
โ   โ   โโโ tasks/
โ   โ   โ   โโโ main.yml
โ   โ   โโโ handlers/
โ   โ   โ   โโโ main.yml
โ   โ   โโโ templates/
โ   โ   โโโ files/
โ   โ   โโโ vars/
โ   โ   โ   โโโ main.yml
โ   โ   โโโ defaults/
โ   โ   โ   โโโ main.yml
โ   โ   โโโ meta/
โ   โ       โโโ main.yml
โ   โโโ webserver/
โ       โโโ ...
โโโ playbooks/                # โ ะะปะตะนะฑัะบะธ ะฒ ะพัะดะตะปัะฝะพะน ะฟะฐะฟะบะต
โ   โโโ deploy.yml
โ   โโโ maintenance.yml
โ   โโโ backup.yml
โโโ site.yml                  # ะะปะฐะฒะฝัะน ะฟะปะตะนะฑัะบ
โโโ requirements.yml          # ะะฐะฒะธัะธะผะพััะธ (ัะพะปะธ, ะบะพะปะปะตะบัะธะธ)
โโโ README.md
```

---

## โ ะะตะฟัะฐะฒะธะปัะฝะฐั ััััะบัััะฐ (ััะพ ะฟัะพะฒะตััะตั ansible-lint)

### 1. group_vars ะฒะฝัััะธ ะบะฐัะฐะปะพะณะฐ ั ะฟะปะตะนะฑัะบะฐะผะธ

```
โ ะะะะฅะ:
playbooks/
โโโ group_vars/          # โ ะะต ะทะดะตัั!
โ   โโโ all.yml
โโโ deploy.yml

โ ะฅะะะะจะ:
project/
โโโ group_vars/          # โ ะ ะบะพัะฝะต ะฟัะพะตะบัะฐ
โ   โโโ all.yml
โโโ playbooks/
    โโโ deploy.yml
```

**ะะพัะตะผั ะฟะปะพัะพ:**
- ะะตัะตะผะตะฝะฝัะต ะฝะต ะฑัะดัั ะฟัะฐะฒะธะปัะฝะพ ะฟัะธะผะตะฝััััั
- ะะฐัััะตะฝะธะต Ansible convention
- ะััะฐะฝะธัะฐ ะฟัะธ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะธ ะฟัะพะตะบัะฐ

---

### 2. ะะพะปะธ ะฝะต ะฒ roles/ ะบะฐัะฐะปะพะณะต

```
โ ะะะะฅะ:
project/
โโโ common/              # โ ะะพะปั ะฒ ะบะพัะฝะต
โ   โโโ tasks/
โโโ site.yml

โ ะฅะะะะจะ:
project/
โโโ roles/               # โ ะะพะปะธ ะฒ roles/
โ   โโโ common/
โ       โโโ tasks/
โโโ site.yml
```

**ะะพัะตะผั ะฟะปะพัะพ:**
- Ansible ะผะพะถะตั ะฝะต ะฝะฐะนัะธ ัะพะปั
- ะะฐัััะตะฝะธะต ััััะบัััั Galaxy
- ะกะปะพะถะฝะพััั ะฟะพะดะดะตัะถะบะธ

---

### 3. ะะปะตะนะฑัะบะธ ะฒะฟะตัะตะผะตัะบั ั ะบะพะฝัะธะณััะฐัะธะตะน

```
โ ะะะะฅะ:
project/
โโโ deploy.yml           # โ ะะฟะตัะตะผะตัะบั
โโโ backup.yml
โโโ group_vars/
โโโ roles/
โโโ ansible.cfg

โ ะฅะะะะจะ:
project/
โโโ playbooks/           # โ ะะปะตะนะฑัะบะธ ะพัะดะตะปัะฝะพ
โ   โโโ deploy.yml
โ   โโโ backup.yml
โโโ group_vars/
โโโ roles/
โโโ site.yml             # ะะปะฐะฒะฝัะน ะฟะปะตะนะฑัะบ ะฒ ะบะพัะฝะต - OK
โโโ ansible.cfg
```

**ะะพัะตะผั ะฟะปะพัะพ:**
- ะะฐัะปะฐะผะปะตะฝะฝัะน ะบะพัะตะฝั ะฟัะพะตะบัะฐ
- ะกะปะพะถะฝะพ ะฝะฐะนัะธ ะฝัะถะฝัะน ะฟะปะตะนะฑัะบ
- ะัะพะฑะปะตะผั ั ะฟัััะผะธ ะฟัะธ ะธะผะฟะพััะต

---

## ๐ ะงัะพ ะฟัะพะฒะตััะตั ansible-lint

### ะะฒัะพะผะฐัะธัะตัะบะธะต ะฟัะพะฒะตัะบะธ ััััะบัััั:

1. **ะะฐัะฟะพะปะพะถะตะฝะธะต ะฟะตัะตะผะตะฝะฝัั**
   - `group_vars/` ะดะพะปะถะฝั ะฑััั ะฒ ะบะพัะฝะต ะธะปะธ ััะดะพะผ ั inventory
   - `host_vars/` ะดะพะปะถะฝั ะฑััั ะฒ ะบะพัะฝะต ะธะปะธ ััะดะพะผ ั inventory
   - ะะต ะฒะฝัััะธ roles/, playbooks/, ะธะปะธ ะดััะณะธั ะบะฐัะฐะปะพะณะพะฒ

2. **ะกัััะบัััะฐ ัะพะปะตะน**
   - ะะพะปะธ ะดะพะปะถะฝั ะฑััั ะฒ `roles/` ะธะปะธ ัััะฐะฝะพะฒะปะตะฝั ัะตัะตะท Galaxy
   - ะะฑัะทะฐัะตะปัะฝัะต ัะฐะนะปั: `tasks/main.yml`
   - ะะตะบะพะผะตะฝะดัะตะผัะต ัะฐะนะปั: `meta/main.yml`, `README.md`

3. **ะะผะตะฝะพะฒะฐะฝะธะต ะธ ะพัะณะฐะฝะธะทะฐัะธั**
   - ะะผะตะฝะฐ ัะพะปะตะน: `lowercase-with-dashes` (ะฝะต `CamelCase` ะธะปะธ `snake_case`)
   - ะะปะตะนะฑัะบะธ: ะพะฟะธัะฐัะตะปัะฝัะต ะธะผะตะฝะฐ (`deploy-webapp.yml` ะปัััะต ัะตะผ `playbook1.yml`)
   - ะะตัะตะผะตะฝะฝัะต: `snake_case` (ะฝะต `CamelCase`)

4. **Galaxy metadata**
   - `meta/main.yml` ั ะฟัะฐะฒะธะปัะฝะพะน ััััะบัััะพะน
   - `galaxy.yml` ะดะปั ะบะพะปะปะตะบัะธะน
   - ะัะฐะฒะธะปัะฝัะต ะฒะตััะธะธ ะธ ะทะฐะฒะธัะธะผะพััะธ

---

## โ๏ธ ะะฐัััะพะนะบะฐ ะฒ ัะฐััะธัะตะฝะธะธ

ะะฐััะธัะตะฝะธะต ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธัะฟะพะปัะทัะตั `.ansible-lint` ะบะพะฝัะธะณััะฐัะธั:

```yaml
# .ansible-lint
profile: production          # ะกััะพะณะธะต ะฟัะพะฒะตัะบะธ

max_line_length: 150         # ะะฐะบัะธะผัะผ 150 ัะธะผะฒะพะปะพะฒ ะฒ ัััะพะบะต

strict: true                 # ะกััะพะณะธะน ัะตะถะธะผ ะดะปั production
```

---

## ๐ฏ ะัะธะผะตัั ะพัะธะฑะพะบ ะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธะน

### ะัะธะฑะบะฐ: group_vars ะฒ ะฝะตะฟัะฐะฒะธะปัะฝะพะผ ะผะตััะต

```
[warning] group_vars should be at the root of the project
File: playbooks/group_vars/all.yml
```

**ะะตัะตะฝะธะต:** ะะตัะตะผะตััะธัะต `group_vars/` ะฒ ะบะพัะตะฝั ะฟัะพะตะบัะฐ

---

### ะัะธะฑะบะฐ: ะะพะปั ะฝะต ะธะผะตะตั meta/main.yml

```
[warning] Role 'webserver' is missing meta/main.yml
File: roles/webserver/
```

**ะะตัะตะฝะธะต:** ะกะพะทะดะฐะนัะต `roles/webserver/meta/main.yml`:

```yaml
---
galaxy_info:
  author: Your Name
  description: Webserver role
  license: MIT
  min_ansible_version: "2.9"
  platforms:
    - name: Ubuntu
      versions:
        - focal
        - jammy

dependencies: []
```

---

### ะัะธะฑะบะฐ: ะะตะฟัะฐะฒะธะปัะฝะพะต ะธะผะตะฝะพะฒะฐะฝะธะต ะฟะตัะตะผะตะฝะฝะพะน

```
[warning] Variable name 'MyVariable' should use snake_case
File: roles/common/vars/main.yml:5
```

**ะะตัะตะฝะธะต:** ะะตัะตะธะผะตะฝัะนัะต ะฒ `my_variable`

---

## ๐ Best Practices

### 1. ะัะฟะพะปัะทัะนัะต inventory ะบะฐัะฐะปะพะณ

```
inventory/
โโโ production/
โ   โโโ hosts
โ   โโโ group_vars/     # โ ะะพะถะฝะพ ะทะดะตัั ะดะปั environment-specific
โโโ staging/
    โโโ hosts
    โโโ group_vars/
```

### 2. ะัะดะตะปัะนัะต ัะพะปะธ ะพั ะฟะปะตะนะฑัะบะพะฒ

```
project/
โโโ roles/              # ะะตัะตะธัะฟะพะปัะทัะตะผะฐั ะปะพะณะธะบะฐ
โ   โโโ common/
โโโ playbooks/          # ะัะบะตัััะฐัะธั
    โโโ deploy.yml
```

### 3. ะัะฟะพะปัะทัะนัะต requirements.yml

```yaml
# requirements.yml
roles:
  - name: geerlingguy.nginx
    version: 3.1.4

collections:
  - name: community.general
    version: 6.0.0
```

### 4. ะะพะบัะผะตะฝัะธััะนัะต ััััะบัััั

ะกะพะทะดะฐะนัะต `README.md` ั ะพะฟะธัะฐะฝะธะตะผ:
- ะะฐะทะฝะฐัะตะฝะธะต ะบะฐะถะดะพะณะพ ะบะฐัะฐะปะพะณะฐ
- ะะฐะบ ะทะฐะฟััะบะฐัั ะฟะปะตะนะฑัะบะธ
- ะะฐะฒะธัะธะผะพััะธ ะธ ััะตะฑะพะฒะฐะฝะธั

---

## ๐ง ะัะพะฒะตัะบะฐ ััััะบัััั

### ะงะตัะตะท ัะฐััะธัะตะฝะธะต

1. ะัะบัะพะนัะต ะฟัะพะตะบั ะฒ VSCode
2. ะะฐะถะผะธัะต **"Check All"** ะฒ ะฟะฐะฝะตะปะธ Ansible Lint
3. ะัะพะฒะตัััะต ะฟัะตะดัะฟัะตะถะดะตะฝะธั ะพ ััััะบัััะต

### ะงะตัะตะท ะบะพะผะฐะฝะดะฝัั ัััะพะบั

```bash
# ะัะพะฒะตัะธัั ะฒะตัั ะฟัะพะตะบั
ansible-lint .

# ะัะพะฒะตัะธัั ะบะพะฝะบัะตัะฝัะน ะฟะปะตะนะฑัะบ
ansible-lint playbooks/deploy.yml

# ะก ะฟะพะดัะพะฑะฝัะผ ะฒัะฒะพะดะพะผ
ansible-lint -v .
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะธะฝัะพัะผะฐัะธั

- [Ansible Best Practices](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)
- [Ansible-lint Rules](https://ansible-lint.readthedocs.io/rules/)
- [Galaxy Role Structure](https://galaxy.ansible.com/docs/contributing/creating_role.html)

---

## โจ ะัะพะณะพ

ะก ะฟัะฐะฒะธะปัะฝะพะน ััััะบัััะพะน ะฟัะพะตะบัะฐ:
- โ Ansible ะฝะฐัะพะดะธั ะฒัะต ะฟะตัะตะผะตะฝะฝัะต ะธ ัะพะปะธ
- โ ะะพะด ะปะตะณะบะพ ัะธัะฐะตััั ะธ ะฟะพะดะดะตัะถะธะฒะฐะตััั
- โ ะัะพะตะบั ะณะพัะพะฒ ะบ ะฟัะฑะปะธะบะฐัะธะธ ะฒ Galaxy
- โ ะะพะผะฐะฝะดะฐ ะฟะพะฝะธะผะฐะตั ะพัะณะฐะฝะธะทะฐัะธั
- โ ะะตะฝััะต ะพัะธะฑะพะบ ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ
